<!DOCTYPE html>
<html>
    <head>
        <title>
            Alarm
        </title>
        <script src="https://coolprogramminguser.github.io/Standards/behavior.js"></script>
        <script>
            var countDown;
            var time;
            var colorChange;
            var colorNumber = 0;
            var sounds = [
                new Sound({"waveform":"square"}),
                new Sound({"waveform":"sawtooth", "frequency":400}),
                new Sound({"waveform":"sawtooth", "frequency":420}),
                new Sound({"waveform":"square", "changeWave":"sawtooth", "modulation":.5, "hertzChange":150}),
                new Sound({"waveform":"square", "changeWave":"square", "modulation":2, "hertzChange":100})
                ];
            function changeBackground(speed) {
                var increment,
                    repeat;
                if (speed.toLowerCase() == "slow") {
                    increment = .1;
                    repeat = 500;
                } else if (speed.toLowerCase() == "fast") {
                    increment = .8;
                    repeat = 8;
                }
                if (colorChange) {
                    clearInterval(colorChange);
                }
                colorChange = setInterval(function() {
                    if (colorNumber > 100) {
                        colorNumber = 0;
                    }
                    var newColor = colorCode(null, colorNumber, [0,0,255], [255,0,0], [0,255,0], [0,0,255]);
                    document.body.style.backgroundImage = "repeating-linear-gradient({0}, white 100vh, {0} 200vh)".format(newColor);
                    // The gradient is basically an image.
                    colorNumber += increment;
                }, repeat);
            }
            window.addEventListener("finished", function() {
                getId("start").addEventListener("click", function() {
                    if (this.innerHTML.trim() == "Start") {
                        this.innerHTML = "Renew";
                        getId("time").style.display = "none";
                        getId("time").value = getId("time").value.trim() ? Number(getId("time").value.trim())*60 : 900;
                        time = Number(getId("time").value);
                        getTag("h2")[0].innerHTML = "Seconds left: " + time;
                        document.title = "Alarm-time: " + time;
                        countDown = setInterval(function() {
                            if (time > 0 ) {
                                getTag("h2")[0].innerHTML = "Seconds left: " + time;
                                document.title = "Alarm-time: " + time;
                                if (time == 5) {
                                    // warning tone
                                    sounds[0].start();
                                    sounds[0].stop(1000);
                                }
                                time--;
                            } else {
                                sounds[1].start();
                                sounds[2].start();
                                setTimeout(function() {
                                    sounds[1].stop();
                                    sounds[2].stop();
                                }, 500);
                                if (time < -8 && !sounds[3].playing) {
                                    sounds[3].start();
                                }
                                if (time < -16 && !sounds[4].playing) {
                                    sounds[4].start();
                                }
                                if (time == 0) {
                                    console.log("time equalled 0");
                                    changeBackground("fast");
                                }
                                time--;
                            }
                        }, 1000);
                    } else {
                        changeBackground("slow");
                        sounds.forEach(function(sound) {
                            sound.stop();
                        });
                        time = Number(getId("time").value);
                        getTag("h2")[0].innerHTML = "Seconds left: " + time;
                        document.title = "Alarm-time: " + time;
                    }
                });
                getId("stop").addEventListener("click", function() {
                    if (confirm("Are you sure you want to stop the alarm?")) {
                        clearInterval(countDown);
                        changeBackground("slow");
                        sounds.forEach(function(sound) {
                            sound.stop();
                        });
                        document.title = "Alarm";
                        getTag("h2")[0].innerHTML = "Seconds left: &infin;";
                        getId("time").value = "";
                        getId("time").style.display = "inline-block";
                        getId("start").innerHTML = "Start";
                    }
                });
                changeBackground("slow");
            });
        </script>
    </head>
    <body>
        <h2>
            Seconds left: &infin;
        </h2>
        <input type="text" id="time" placeholder="Time to recur (minutes)">
        <br>
        <br>
        <button id="start">
            Start
        </button>
        <span>&nbsp;</span>
        <button id="stop">
            Stop
        </button>
    </body>
<html>
